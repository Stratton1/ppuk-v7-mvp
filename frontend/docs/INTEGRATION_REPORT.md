# Integration Report (Phase 7 pre-check)\n\nOverview of frontend â†” backend/Supabase touchpoints and current risks.\n\n## Critical RPC/Endpoint Dependencies\n- Permissions: `can_view_property`, `can_edit_property`, `grant_property_role`, `revoke_property_role`, `set_public_visibility`.\n- Admin dashboards: `get_admin_dashboard_stats`, `get_properties_over_time`, `get_user_growth`, `get_document_uploads_over_time`, `get_api_usage_by_provider`, `get_admin_users`, `get_audit_logs`.\n- Property content: standard tables `properties`, `documents`, `media`, `property_flags`, `property_events`, `tasks`, `watchlist`, `property_stakeholders`, `invitations` with soft-delete columns.\n- Auth helper endpoints: `/api/test/reset` and `/api/test/seed` used by Playwright flows; `/test/login` page for deterministic logins.\n\n## Known Gaps / Follow-ups\n- Supabase admin SDK: `supabase.auth.admin.getUserByEmail` is unavailable in current stack; backend fix needed for `/api/test/seed` and build to pass.\n- Admin RPCs must exist and match expected payloads; frontend now guards with try/catch and empty states but metrics will show empty if RPCs are missing.\n- Server components still use real Supabase even when `NEXT_PUBLIC_USE_MOCKS=true`; mock mode is client-only. Ensure backend is reachable (or add server-side mocks) for full offline parity.\n\n## Integration Expectations\n- RLS enforced: all property-related tables must keep policies aligned with `can_view_property`/`can_edit_property` helpers.\n- Signed URL storage: buckets `property-documents` and `property-media` expected; signed URL generation via `lib/signed-url.ts`.\n- Invitations: `invitations` table requires `expires_at`, `status`, `property_permission` fields used by `property-invitations` actions.\n\n## Recommended Next Steps\n- Implement/restore missing admin RPCs listed above; ensure they return non-null defaults to keep dashboards populated.\n- Replace unsupported `getUserByEmail` usage on backend with supported admin SDK calls (e.g., `listUsers` + filter) to unblock `/api/test/seed` and CI builds.\n- Add backend health check in CI for `/api/test/reset` and admin RPC availability to catch regressions early.\n- Consider optional server-side mock layer for dev when Supabase is unavailable; today only client is mocked.\n*** End Patch
